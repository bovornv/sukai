/**
 * Generate diagnosis with recommendations
 * Follows PROBLEM_DRIVEN_IMPLEMENTATION.md strictly
 * Every feature must solve: uncertainty, cost, or follow-up
 */

const RECOMMENDATIONS_BY_TRIAGE = {
  self_care: {
    home_care: [
      'üõå ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠',
      'üíß ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡πà‡∏ô‡∏ö‡πà‡∏≠‡∏¢ ‡πÜ',
      'üßä ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏¢‡πá‡∏ô',
    ],
    otc_meds: [
      'üíä ‡∏û‡∏≤‡∏£‡∏≤‡πÄ‡∏ã‡∏ï‡∏≤‡∏°‡∏≠‡∏• ‚Äî ‡∏•‡∏î‡∏õ‡∏ß‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏Ç‡πâ\n   ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ: ‡∏ó‡∏∏‡∏Å 6 ‡∏ä‡∏°. ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£\n   ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 4,000 ‡∏°‡∏Å./‡∏ß‡∏±‡∏ô\n   üí° ‡∏û‡∏≠‡πÄ‡∏´‡∏°‡∏≤‡∏∞ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô',
      'üåø ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡πÄ‡∏ã‡∏ï‡∏≤‡∏°‡∏≠‡∏•‡πÅ‡∏ö‡∏ö‡∏ô‡πâ‡∏≥ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å)\n   ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ: ‡∏ï‡∏≤‡∏°‡∏â‡∏•‡∏≤‡∏Å‡∏¢‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏î\n   ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏≤‡∏°‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ',
    ],
    when_to_see_doctor: [
      'üìÖ ‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô 2‚Äì3 ‡∏ß‡∏±‡∏ô',
      'ü§í ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ 38.5¬∞C',
      'üò£ ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏•‡∏á',
    ],
    danger_signs: [
      'üö® ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏•‡∏≥‡∏ö‡∏≤‡∏Å',
      'üí• ‡πÄ‡∏à‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏Å‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á',
      'üòµ ‡∏´‡∏°‡∏î‡∏™‡∏ï‡∏¥ / ‡∏ä‡∏±‡∏Å',
    ],
    additional_advice: [
      'üìù ‡∏à‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á',
      'üì± ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ',
      '‚è∞ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24‚Äì48 ‡∏ä‡∏°.',
      '‚ùó ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ: ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏•‡∏á, ‡∏°‡∏µ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á, ‡∏õ‡∏ß‡∏î‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô',
    ],
  },
  pharmacy: {
      home_care: [
        'üõå ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠',
        'üíß ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡πà‡∏ô‡∏ö‡πà‡∏≠‡∏¢ ‡πÜ',
        'üßä ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏¢‡πá‡∏ô',
      ],
      otc_meds: [
        'üíä ‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏≤‡∏°‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°\n   ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ: ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏≠‡∏á‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£\n   ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏≠‡πà‡∏≤‡∏ô‡∏â‡∏•‡∏≤‡∏Å‡∏¢‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á\n   üí° ‡∏û‡∏≠‡πÄ‡∏´‡∏°‡∏≤‡∏∞ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô',
        'üåø ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡πÄ‡∏ã‡∏ï‡∏≤‡∏°‡∏≠‡∏• (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÑ‡∏Ç‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏ß‡∏î)\n   ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ: ‡∏ó‡∏∏‡∏Å 6 ‡∏ä‡∏°. ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£\n   ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 4,000 ‡∏°‡∏Å./‡∏ß‡∏±‡∏ô',
      ],
    when_to_see_doctor: [
      'üìÖ ‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô 2‚Äì3 ‡∏ß‡∏±‡∏ô',
      'ü§í ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ 38.5¬∞C',
      'üò£ ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏•‡∏á',
    ],
    danger_signs: [
      'üö® ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏•‡∏≥‡∏ö‡∏≤‡∏Å',
      'üí• ‡πÄ‡∏à‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏Å‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á',
      'üòµ ‡∏´‡∏°‡∏î‡∏™‡∏ï‡∏¥ / ‡∏ä‡∏±‡∏Å',
    ],
    additional_advice: [
      'üìù ‡∏à‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á',
      'üì± ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ',
      '‚è∞ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24‚Äì48 ‡∏ä‡∏°.',
      '‚ùó ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ: ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏•‡∏á, ‡∏°‡∏µ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á, ‡∏õ‡∏ß‡∏î‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô',
    ],
  },
  gp: {
    home_care: [
      'üõå ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠',
      'üíß ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡πà‡∏ô‡∏ö‡πà‡∏≠‡∏¢ ‡πÜ',
    ],
    otc_meds: [
      'üíä ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ö‡∏£‡∏£‡πÄ‡∏ó‡∏≤‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß\n   ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ: ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå\n   ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏£‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏≠‡∏∑‡πà‡∏ô',
      'üåø ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡πÄ‡∏ã‡∏ï‡∏≤‡∏°‡∏≠‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏£‡πÄ‡∏ó‡∏≤‡∏≠‡∏≤‡∏Å‡∏≤‡∏£\n   ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ: ‡∏ó‡∏∏‡∏Å 6 ‡∏ä‡∏°. ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£\n   ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏≤‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ',
    ],
    when_to_see_doctor: [
      'üë®‚Äç‚öïÔ∏è ‡∏Ñ‡∏ß‡∏£‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1‚Äì2 ‡∏ß‡∏±‡∏ô',
      'üìÖ ‡∏≠‡∏¢‡πà‡∏≤‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏ß‡πâ',
      'üìù ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏£',
    ],
    danger_signs: [
      'üö® ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏•‡∏≥‡∏ö‡∏≤‡∏Å',
      'üí• ‡πÄ‡∏à‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏Å‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á',
      'üòµ ‡∏´‡∏°‡∏î‡∏™‡∏ï‡∏¥ / ‡∏ä‡∏±‡∏Å',
    ],
    additional_advice: [
      'üìù ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏•‡πà‡∏≤‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ü‡∏±‡∏á',
      'üíä ‡∏ô‡∏≥‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢',
      'üë®‚Äç‚öïÔ∏è ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ Premium Doctor Review ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πâ‡∏≥‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà AI ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡πâ‡∏ß',
      '‚è∞ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24‚Äì48 ‡∏ä‡∏°.',
    ],
  },
  emergency: {
    home_care: [],
    otc_meds: [],
    when_to_see_doctor: [
      'üè• ‡πÑ‡∏õ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
      '‚è±Ô∏è ‡∏≠‡∏¢‡πà‡∏≤‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏•‡∏á',
      'üìû ‡πÇ‡∏ó‡∏£ 1669 ‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô',
    ],
    danger_signs: [
      'üö® ‡∏†‡∏≤‡∏ß‡∏∞‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô',
      '‚ö†Ô∏è ‡∏≠‡∏¢‡πà‡∏≤‡∏ä‡∏∞‡∏•‡πà‡∏≤‡πÉ‡∏à',
      'üè• ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
    ],
    additional_advice: [
      'üè• ‡πÑ‡∏õ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
      '‚è±Ô∏è ‡∏≠‡∏¢‡πà‡∏≤‡∏£‡∏≠',
      'üìû ‡πÇ‡∏ó‡∏£ 1669 ‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô',
    ],
  },
  uncertain: {
    home_care: [
      'üõå ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠',
      'üëÄ ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î',
    ],
    otc_meds: [
      'üíä ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏¢‡∏≤',
    ],
    when_to_see_doctor: [
      'üë®‚Äç‚öïÔ∏è ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°',
      'üìÖ ‡∏≠‡∏¢‡πà‡∏≤‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏ß‡πâ',
    ],
    danger_signs: [
      'üö® ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥',
      '‚ö†Ô∏è ‡∏´‡∏≤‡∏Å‡πÅ‡∏¢‡πà‡∏•‡∏á‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
    ],
    additional_advice: [
      'üë®‚Äç‚öïÔ∏è ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå',
      'üìù ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°',
      '‚è∞ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24‚Äì48 ‡∏ä‡∏°.',
      '‚ùó ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ: ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏•‡∏á, ‡∏°‡∏µ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á, ‡∏õ‡∏ß‡∏î‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô',
    ],
  },
};

/**
 * Generate explainable summary based on triage level and clinical reasoning
 * Doctor-level explanation: WHY this triage level, not just WHAT
 * Must provide: clear triage result, clear next action, clear safety boundary
 * NEW REQUIREMENT: Every diagnosis MUST start with clear severity statement + WHY
 */
function generateSummary(triageLevel, symptom = '', answers = {}, riskScore = 0) {
  const normalizedSymptom = symptom.toLowerCase();
  
  // Generate WHY explanation based on clinical reasoning
  let whyExplanation = '';
  
  if (triageLevel === 'emergency') {
    whyExplanation = '‡∏û‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏•‡∏≥‡∏ö‡∏≤‡∏Å, ‡πÄ‡∏à‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏Å, ‡∏´‡∏°‡∏î‡∏™‡∏ï‡∏¥) ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ';
  } else if (triageLevel === 'gp') {
    if (riskScore >= 60) {
      whyExplanation = '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏¢‡∏∏, ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß, ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏•‡∏á) ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢';
    } else if (answers.trend && answers.trend.includes('‡πÅ‡∏¢‡πà‡∏•‡∏á')) {
      whyExplanation = '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏•‡∏á‡πÅ‡∏°‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏';
    } else if (answers.self_care_response && answers.self_care_response.includes('‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô')) {
      whyExplanation = '‡∏•‡∏≠‡∏á‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á';
    } else {
      whyExplanation = '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ñ‡∏∂‡∏á‡∏™‡∏π‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢';
    }
  } else if (triageLevel === 'pharmacy') {
    if (normalizedSymptom.includes('‡πÑ‡∏Ç‡πâ') || normalizedSymptom.includes('‡∏õ‡∏ß‡∏î')) {
      whyExplanation = '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡πÄ‡∏ó‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏≤‡∏¢‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô';
    } else {
      whyExplanation = '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡πÄ‡∏ó‡∏≤';
    }
  } else if (triageLevel === 'self_care') {
    whyExplanation = '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ';
  } else {
    whyExplanation = '‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡πà‡πÉ‡∏à';
  }
  
  const summaries = {
    self_care: {
      severity: 'üü¢ ‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ',
      why: whyExplanation || '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢',
      action: 'üè† ‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ',
      followup: '‚è∞ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ 24‚Äì48 ‡∏ä‡∏°.',
    },
    pharmacy: {
      severity: 'üü° ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° / ‡∏û‡∏ö‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£',
      why: whyExplanation || '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡πÄ‡∏ó‡∏≤',
      action: 'üíä ‡πÑ‡∏õ‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏á',
      followup: '‚è∞ ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô 2‚Äì3 ‡∏ß‡∏±‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå',
    },
    gp: {
      severity: 'üü° ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° / ‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå',
      why: whyExplanation || '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏à‡∏≤‡∏Å‡πÅ‡∏û‡∏ó‡∏¢‡πå',
      action: 'üìÖ ‡∏Ñ‡∏ß‡∏£‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1‚Äì2 ‡∏ß‡∏±‡∏ô',
      followup: 'üìå ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°',
    },
    emergency: {
      severity: 'üî¥ ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô',
      why: whyExplanation || '‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
      action: 'üè• ‡πÑ‡∏õ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
      followup: '‚ö†Ô∏è ‡∏≠‡∏¢‡πà‡∏≤‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏•‡∏á',
    },
    uncertain: {
      severity: 'üü° ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå',
      why: whyExplanation || '‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡πà‡πÉ‡∏à',
      action: 'üìÖ ‡∏Ñ‡∏ß‡∏£‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô',
      followup: 'üìù ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°',
    },
  };
  const summary = summaries[triageLevel] || summaries.uncertain;
  return `${summary.severity}\n${summary.why}\n${summary.action}\n${summary.followup}`;
}

/**
 * Generate diagnosis response with clinical reasoning
 * Doctor-level explainable recommendations
 * PROBLEM_DRIVEN_IMPLEMENTATION.md: Every diagnosis MUST include all sections
 * Must provide: clear triage result, clear next action, clear safety boundary
 * NEW: Include severity statement, WHY explanation, follow-up timing, watch signs
 */
export async function generateDiagnosis({ symptoms, answers, triageLevel, riskScore = 0 }) {
  try {
    // Ensure we never return uncertain without clear guidance
    const finalTriage = triageLevel === 'uncertain' ? 'gp' : (triageLevel || 'self_care');
    const recommendations = RECOMMENDATIONS_BY_TRIAGE[finalTriage] || RECOMMENDATIONS_BY_TRIAGE.gp;
    const symptomText = Array.isArray(symptoms) ? symptoms.join(' ') : (symptoms || '');
    const summary = generateSummary(finalTriage, symptomText, answers, riskScore);

    // Extract severity and why from summary
    const summaryLines = summary.split('\n');
    const severityStatement = summaryLines[0] || '';
    const whyExplanation = summaryLines[1] || '';

    // Safely extract watch signs
    const additionalAdvice = recommendations.additional_advice || [];
    const watchSignsItem = Array.isArray(additionalAdvice) 
      ? additionalAdvice.find(item => typeof item === 'string' && item.includes('‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì'))
      : null;
    const watchSigns = watchSignsItem || '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏•‡∏á, ‡∏°‡∏µ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á, ‡∏õ‡∏ß‡∏î‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô';

    // Ensure all recommendation arrays exist
    const safeRecommendations = {
      home_care: Array.isArray(recommendations.home_care) ? recommendations.home_care : [],
      otc_meds: Array.isArray(recommendations.otc_meds) ? recommendations.otc_meds : [],
      when_to_see_doctor: Array.isArray(recommendations.when_to_see_doctor) ? recommendations.when_to_see_doctor : [],
      danger_signs: Array.isArray(recommendations.danger_signs) ? recommendations.danger_signs : [],
      additional_advice: Array.isArray(recommendations.additional_advice) ? recommendations.additional_advice : [],
    };

    // PROBLEM_DRIVEN_IMPLEMENTATION.md: All sections must appear, 3-5 items each
    return {
      triage_level: finalTriage, // Clear result
      summary, // Clear next action
      severity_statement: severityStatement, // üü¢üü°üî¥ traffic light
      why_explanation: whyExplanation, // WHY in 1 sentence
      recommendations: safeRecommendations,
      follow_up: {
        timing: finalTriage === 'emergency' ? '‡∏ó‡∏±‡∏ô‡∏ó‡∏µ' : '24‚Äì48 ‡∏ä‡∏°.',
        watch_signs: watchSigns,
      },
    };
  } catch (error) {
    console.error('Error generating diagnosis:', error);
    // Fallback to safe defaults
    const fallbackTriage = 'self_care';
    const fallbackRecs = RECOMMENDATIONS_BY_TRIAGE[fallbackTriage];
    const fallbackSummary = generateSummary(fallbackTriage);
    const summaryLines = fallbackSummary.split('\n');
    
    return {
      triage_level: fallbackTriage,
      summary: fallbackSummary,
      severity_statement: summaryLines[0] || 'üü¢ ‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ',
      why_explanation: summaryLines[1] || '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á',
      recommendations: {
        home_care: fallbackRecs.home_care || [],
        otc_meds: fallbackRecs.otc_meds || [],
        when_to_see_doctor: fallbackRecs.when_to_see_doctor || [],
        danger_signs: fallbackRecs.danger_signs || [],
        additional_advice: fallbackRecs.additional_advice || [],
      },
      follow_up: {
        timing: '24‚Äì48 ‡∏ä‡∏°.',
        watch_signs: '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏•‡∏á, ‡∏°‡∏µ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á, ‡∏õ‡∏ß‡∏î‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô',
      },
    };
  }
}
