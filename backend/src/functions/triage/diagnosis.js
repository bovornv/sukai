/**
 * Generate diagnosis with recommendations
 * Follows PROBLEM_DRIVEN_IMPLEMENTATION.md strictly
 * Every feature must solve: uncertainty, cost, or follow-up
 */

const RECOMMENDATIONS_BY_TRIAGE = {
  self_care: {
    home_care: [
      'ЁЯЫМ р╕Юр╕▒р╕Бр╕Ьр╣Ир╕нр╕Щр╣Гр╕лр╣Йр╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н',
      'ЁЯТз р╕Фр╕╖р╣Ир╕бр╕Щр╣Йр╕│р╕нр╕╕р╣Ир╕Щр╕Ър╣Ир╕нр╕в р╣Ж',
      'ЁЯзК р╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕Зр╕Вр╕нр╕Зр╣Ар╕вр╣Зр╕Щ',
    ],
    otc_meds: [
      'ЁЯТК р╕Юр╕▓р╕гр╕▓р╣Ар╕Лр╕Хр╕▓р╕бр╕нр╕е тАФ р╕ер╕Фр╕Ыр╕зр╕Ф',
      'тП▒ р╕Чр╕╕р╕Б 6 р╕Кр╕б. р╕лр╕ер╕▒р╕Зр╕нр╕▓р╕лр╕▓р╕г',
      'тЪая╕П р╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ 4,000 р╕бр╕Б./р╕зр╕▒р╕Щ',
    ],
    when_to_see_doctor: [
      'ЁЯУЕ р╣Др╕бр╣Ир╕Фр╕╡р╕Вр╕╢р╣Йр╕Щр╣Гр╕Щ 2тАУ3 р╕зр╕▒р╕Щ',
      'ЁЯдТ р╣Др╕Вр╣Йр╕кр╕╣р╕Зр╕Бр╕зр╣Ир╕▓ 38.5┬░C',
      'ЁЯШг р╕нр╕▓р╕Бр╕▓р╕гр╣Бр╕вр╣Ир╕ер╕З',
    ],
    danger_signs: [
      'ЁЯЪи р╕лр╕▓р╕вр╣Гр╕Ир╕ер╕│р╕Ър╕▓р╕Б',
      'ЁЯТе р╣Ар╕Ир╣Зр╕Ър╕лр╕Щр╣Йр╕▓р╕нр╕Бр╕гр╕╕р╕Щр╣Бр╕гр╕З',
      'ЁЯШ╡ р╕лр╕бр╕Фр╕кр╕Хр╕┤ / р╕Кр╕▒р╕Б',
    ],
    additional_advice: [
      'ЁЯУЭ р╕Ир╕Фр╕нр╕▓р╕Бр╕▓р╕гр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Бр╕Ыр╕ер╕З',
      'ЁЯУ▒ р╕Бр╕ер╕▒р╕Ър╕бр╕▓р╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╣Гр╕лр╕бр╣Ир╣Др╕Фр╣Й',
      'ЁЯСитАНтЪХя╕П р╕Ыр╕гр╕╢р╕Бр╕йр╕▓р╣Бр╕Юр╕Чр╕вр╣Мр╕лр╕▓р╕Бр╕Бр╕▒р╕Зр╕зр╕е',
    ],
  },
  pharmacy: {
    home_care: [
      'ЁЯЫМ р╕Юр╕▒р╕Бр╕Ьр╣Ир╕нр╕Щр╣Гр╕лр╣Йр╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н',
      'ЁЯТз р╕Фр╕╖р╣Ир╕бр╕Щр╣Йр╕│р╕нр╕╕р╣Ир╕Щр╕Ър╣Ир╕нр╕в р╣Ж',
      'ЁЯзК р╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕Зр╕Вр╕нр╕Зр╣Ар╕вр╣Зр╕Щ',
    ],
    otc_meds: [
      'ЁЯТК р╣Др╕Ыр╕гр╣Йр╕▓р╕Щр╕вр╕▓р╣Ар╕Юр╕╖р╣Ир╕нр╕Лр╕╖р╣Йр╕нр╕вр╕▓р╣Гр╕Кр╣Йр╣Ар╕нр╕З',
      'ЁЯСитАНтЪХя╕П р╕Ыр╕гр╕╢р╕Бр╕йр╕▓р╣Ар╕ар╕кр╕▒р╕Кр╕Бр╕г',
      'ЁЯУЛ р╕нр╣Ир╕▓р╕Щр╕Йр╕ер╕▓р╕Бр╕вр╕▓р╕нр╕вр╣Ир╕▓р╕Зр╕гр╕░р╕бр╕▒р╕Фр╕гр╕░р╕зр╕▒р╕З',
    ],
    when_to_see_doctor: [
      'ЁЯУЕ р╣Др╕бр╣Ир╕Фр╕╡р╕Вр╕╢р╣Йр╕Щр╣Гр╕Щ 2тАУ3 р╕зр╕▒р╕Щ',
      'ЁЯдТ р╣Др╕Вр╣Йр╕кр╕╣р╕Зр╕Бр╕зр╣Ир╕▓ 38.5┬░C',
      'ЁЯШг р╕нр╕▓р╕Бр╕▓р╕гр╣Бр╕вр╣Ир╕ер╕З',
    ],
    danger_signs: [
      'ЁЯЪи р╕лр╕▓р╕вр╣Гр╕Ир╕ер╕│р╕Ър╕▓р╕Б',
      'ЁЯТе р╣Ар╕Ир╣Зр╕Ър╕лр╕Щр╣Йр╕▓р╕нр╕Бр╕гр╕╕р╕Щр╣Бр╕гр╕З',
      'ЁЯШ╡ р╕лр╕бр╕Фр╕кр╕Хр╕┤ / р╕Кр╕▒р╕Б',
    ],
    additional_advice: [
      'ЁЯУЭ р╕Ир╕Фр╕нр╕▓р╕Бр╕▓р╕гр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Бр╕Ыр╕ер╕З',
      'ЁЯУ▒ р╕Бр╕ер╕▒р╕Ър╕бр╕▓р╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╣Гр╕лр╕бр╣Ир╣Др╕Фр╣Й',
      'ЁЯСитАНтЪХя╕П р╕Ыр╕гр╕╢р╕Бр╕йр╕▓р╣Бр╕Юр╕Чр╕вр╣Мр╕лр╕▓р╕Бр╕Бр╕▒р╕Зр╕зр╕е',
    ],
  },
  gp: {
    home_care: [
      'ЁЯЫМ р╕Юр╕▒р╕Бр╕Ьр╣Ир╕нр╕Щр╣Гр╕лр╣Йр╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н',
      'ЁЯТз р╕Фр╕╖р╣Ир╕бр╕Щр╣Йр╕│р╕нр╕╕р╣Ир╕Щр╕Ър╣Ир╕нр╕в р╣Ж',
    ],
    otc_meds: [
      'ЁЯТК р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Гр╕Кр╣Йр╕вр╕▓р╕Ър╕гр╕гр╣Ар╕Чр╕▓р╕нр╕▓р╕Бр╕▓р╕гр╣Др╕Фр╣Йр╕Кр╕▒р╣Ир╕зр╕Др╕гр╕▓р╕з',
      'тП▒ р╕гр╕нр╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╕Ир╕▓р╕Бр╣Бр╕Юр╕Чр╕вр╣М',
    ],
    when_to_see_doctor: [
      'ЁЯСитАНтЪХя╕П р╕Др╕зр╕гр╕Юр╕Ър╣Бр╕Юр╕Чр╕вр╣Мр╕ар╕▓р╕вр╣Гр╕Щ 1тАУ2 р╕зр╕▒р╕Щ',
      'ЁЯУЕ р╕нр╕вр╣Ир╕▓р╕Ыр╕ер╣Ир╕нр╕вр╕Чр╕┤р╣Йр╕Зр╣Др╕зр╣Й',
      'ЁЯУЭ р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕▓р╕Бр╕▓р╕г',
    ],
    danger_signs: [
      'ЁЯЪи р╕лр╕▓р╕вр╣Гр╕Ир╕ер╕│р╕Ър╕▓р╕Б',
      'ЁЯТе р╣Ар╕Ир╣Зр╕Ър╕лр╕Щр╣Йр╕▓р╕нр╕Бр╕гр╕╕р╕Щр╣Бр╕гр╕З',
      'ЁЯШ╡ р╕лр╕бр╕Фр╕кр╕Хр╕┤ / р╕Кр╕▒р╕Б',
    ],
    additional_advice: [
      'ЁЯУЭ р╣Ар╕Хр╕гр╕╡р╕вр╕бр╣Ар╕ер╣Ир╕▓р╕нр╕▓р╕Бр╕▓р╕гр╣Гр╕лр╣Йр╣Бр╕Юр╕Чр╕вр╣Мр╕Яр╕▒р╕З',
      'ЁЯТК р╕Щр╕│р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕вр╕▓р╕бр╕▓р╕Фр╣Йр╕зр╕в',
      'тЪая╕П р╕нр╕вр╣Ир╕▓р╕Кр╕░р╕ер╣Ир╕▓р╣Гр╕И',
    ],
  },
  emergency: {
    home_care: [],
    otc_meds: [],
    when_to_see_doctor: [
      'ЁЯПе р╣Др╕Ыр╣Вр╕гр╕Зр╕Юр╕вр╕▓р╕Ър╕▓р╕ер╕Чр╕▒р╕Щр╕Чр╕╡',
      'тП▒я╕П р╕нр╕вр╣Ир╕▓р╕гр╕нр╣Гр╕лр╣Йр╕нр╕▓р╕Бр╕▓р╕гр╣Бр╕вр╣Ир╕ер╕З',
      'ЁЯУЮ р╣Вр╕Чр╕г 1669 р╕лр╕▓р╕Бр╕Ир╕│р╣Ар╕Ыр╣Зр╕Щ',
    ],
    danger_signs: [
      'ЁЯЪи р╕ар╕▓р╕зр╕░р╕Йр╕╕р╕Бр╣Ар╕Йр╕┤р╕Щ',
      'тЪая╕П р╕нр╕вр╣Ир╕▓р╕Кр╕░р╕ер╣Ир╕▓р╣Гр╕И',
      'ЁЯПе р╕Хр╣Йр╕нр╕Зр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Фр╕╣р╣Бр╕ер╕Чр╕▒р╕Щр╕Чр╕╡',
    ],
    additional_advice: [
      'ЁЯПе р╣Др╕Ыр╣Вр╕гр╕Зр╕Юр╕вр╕▓р╕Ър╕▓р╕ер╕Чр╕▒р╕Щр╕Чр╕╡',
      'тП▒я╕П р╕нр╕вр╣Ир╕▓р╕гр╕н',
      'ЁЯУЮ р╣Вр╕Чр╕г 1669 р╕лр╕▓р╕Бр╕Ир╕│р╣Ар╕Ыр╣Зр╕Щ',
    ],
  },
  uncertain: {
    home_care: [
      'ЁЯЫМ р╕Юр╕▒р╕Бр╕Ьр╣Ир╕нр╕Щр╣Гр╕лр╣Йр╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н',
      'ЁЯСА р╕кр╕▒р╕Зр╣Ар╕Бр╕Хр╕нр╕▓р╕Бр╕▓р╕гр╕нр╕вр╣Ир╕▓р╕Зр╣Гр╕Бр╕ер╣Йр╕Кр╕┤р╕Ф',
    ],
    otc_meds: [
      'ЁЯТК р╕Др╕зр╕гр╕Ыр╕гр╕╢р╕Бр╕йр╕▓р╣Бр╕Юр╕Чр╕вр╣Мр╕Бр╣Ир╕нр╕Щр╣Гр╕Кр╣Йр╕вр╕▓',
    ],
    when_to_see_doctor: [
      'ЁЯСитАНтЪХя╕П р╕Др╕зр╕гр╕Ыр╕гр╕╢р╕Бр╕йр╕▓р╣Бр╕Юр╕Чр╕вр╣Мр╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б',
      'ЁЯУЕ р╕нр╕вр╣Ир╕▓р╕Ыр╕ер╣Ир╕нр╕вр╕Чр╕┤р╣Йр╕Зр╣Др╕зр╣Й',
    ],
    danger_signs: [
      'ЁЯЪи р╕кр╕▒р╕Зр╣Ар╕Бр╕Хр╕нр╕▓р╕Бр╕▓р╕гр╕Ьр╕┤р╕Фр╕Ыр╕Бр╕Хр╕┤',
      'тЪая╕П р╕лр╕▓р╕Бр╣Бр╕вр╣Ир╕ер╕Зр╣Гр╕лр╣Йр╣Др╕Ыр╕Юр╕Ър╣Бр╕Юр╕Чр╕вр╣Мр╕Чр╕▒р╕Щр╕Чр╕╡',
    ],
    additional_advice: [
      'ЁЯСитАНтЪХя╕П р╕Др╕зр╕гр╕Ыр╕гр╕╢р╕Бр╕йр╕▓р╣Бр╕Юр╕Чр╕вр╣М',
      'ЁЯУЭ р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕▓р╕Бр╕▓р╕гр╣Гр╕лр╣Йр╕Юр╕гр╣Йр╕нр╕б',
    ],
  },
};

/**
 * Generate summary based on triage level
 * PROBLEM_DRIVEN_IMPLEMENTATION.md: Must be 2-4 short lines, emoji-based, calm tone
 * Must provide: clear triage result, clear next action, clear safety boundary
 */
function generateSummary(triageLevel) {
  const summaries = {
    self_care: 'ЁЯТК р╕нр╕▓р╕Бр╕▓р╕гр╣Др╕бр╣Ир╕гр╕╕р╕Щр╣Бр╕гр╕З\nЁЯПа р╕Фр╕╣р╣Бр╕ер╕Хр╕▒р╕зр╣Ар╕нр╕Зр╕Чр╕╡р╣Ир╕Ър╣Йр╕▓р╕Щр╣Др╕Фр╣Й\nтП░ р╕Хр╕┤р╕Фр╕Хр╕▓р╕бр╕нр╕▓р╕Бр╕▓р╕г 24тАУ48 р╕Кр╕б.',
    pharmacy: 'ЁЯТК р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Др╕Ыр╕гр╣Йр╕▓р╕Щр╕вр╕▓р╣Др╕Фр╣Й\nЁЯПе р╕нр╕▓р╕Бр╕▓р╕гр╣Др╕бр╣Ир╕гр╕╕р╕Щр╣Бр╕гр╕Зр╕бр╕▓р╕Б\nтП░ р╕лр╕▓р╕Бр╣Др╕бр╣Ир╕Фр╕╡р╕Вр╕╢р╣Йр╕Щр╣Гр╕Щ 2тАУ3 р╕зр╕▒р╕Щ',
    gp: 'ЁЯСитАНтЪХя╕П р╕Др╕зр╕гр╕Юр╕Ър╣Бр╕Юр╕Чр╕вр╣М\nЁЯУЕ р╕ар╕▓р╕вр╣Гр╕Щ 1тАУ2 р╕зр╕▒р╕Щ\nЁЯУМ р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕▓р╕Бр╕▓р╕г',
    emergency: 'ЁЯЪи р╕нр╕▓р╕Бр╕▓р╕гр╕Йр╕╕р╕Бр╣Ар╕Йр╕┤р╕Щ\nЁЯПе р╣Др╕Ыр╣Вр╕гр╕Зр╕Юр╕вр╕▓р╕Ър╕▓р╕ер╕Чр╕▒р╕Щр╕Чр╕╡\nтЪая╕П р╕нр╕вр╣Ир╕▓р╕гр╕нр╣Гр╕лр╣Йр╕нр╕▓р╕Бр╕▓р╕гр╣Бр╕вр╣Ир╕ер╕З',
    uncertain: 'ЁЯСитАНтЪХя╕П р╕Др╕зр╕гр╕Ыр╕гр╕╢р╕Бр╕йр╕▓р╣Бр╕Юр╕Чр╕вр╣М\nЁЯУЕ р╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б\nЁЯУЭ р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕▓р╕Бр╕▓р╕г',
  };
  return summaries[triageLevel] || summaries.uncertain;
}

/**
 * Generate diagnosis response
 * PROBLEM_DRIVEN_IMPLEMENTATION.md: Every diagnosis MUST include all sections
 * Must provide: clear triage result, clear next action, clear safety boundary
 */
export async function generateDiagnosis({ symptoms, answers, triageLevel }) {
  // Ensure we never return uncertain without clear guidance
  const finalTriage = triageLevel === 'uncertain' ? 'gp' : triageLevel;
  const recommendations = RECOMMENDATIONS_BY_TRIAGE[finalTriage] || RECOMMENDATIONS_BY_TRIAGE.gp;
  const summary = generateSummary(finalTriage);

  // PROBLEM_DRIVEN_IMPLEMENTATION.md: All sections must appear, 3-5 items each
  return {
    triage_level: finalTriage, // Clear result
    summary, // Clear next action
    recommendations: {
      home_care: recommendations.home_care,
      otc_meds: recommendations.otc_meds,
      when_to_see_doctor: recommendations.when_to_see_doctor, // Clear next action
      danger_signs: recommendations.danger_signs, // Clear safety boundary
      additional_advice: recommendations.additional_advice,
    },
  };
}
